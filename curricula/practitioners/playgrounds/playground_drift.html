<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drift Detection Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        h1 { font-size: 1.5rem; color: #0f172a; margin-bottom: 4px; }
        .header-subtitle { font-size: 0.9rem; color: #64748b; }

        .reset-btn {
            background: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .reset-btn:hover { background: #f1f5f9; color: #475569; }

        .start-banner {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
        }
        .start-banner-icon { font-size: 2.5rem; flex-shrink: 0; }
        .start-banner-content h2 { font-size: 1.1rem; margin-bottom: 8px; font-weight: 600; }
        .start-banner-content p { font-size: 0.85rem; opacity: 0.9; margin-bottom: 12px; }

        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-label {
            font-size: 0.8rem;
            color: #64748b;
        }
        input[type="range"] {
            width: 150px;
        }
        .control-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: #1e293b;
            min-width: 40px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #f97316;
            color: white;
        }
        .btn-primary:hover { background: #ea580c; }
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }
        .btn-secondary:hover { background: #e2e8f0; }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 16px;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .panel-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .panel-badge {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 10px;
        }
        .badge-healthy { background: #dcfce7; color: #166534; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-critical { background: #fee2e2; color: #991b1b; }

        .chart-container {
            position: relative;
            height: 200px;
            margin-bottom: 16px;
        }
        canvas {
            width: 100%;
            height: 100%;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .metric-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .metric-card.alert {
            background: #fef2f2;
            border-color: #fecaca;
        }
        .metric-card.warning {
            background: #fef3c7;
            border-color: #fcd34d;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
        }
        .metric-value.good { color: #10b981; }
        .metric-value.warning { color: #f59e0b; }
        .metric-value.bad { color: #ef4444; }
        .metric-label {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 4px;
        }

        .alert-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .alert-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }
        .alert-item.warning {
            background: #fef3c7;
            border-color: #fcd34d;
        }
        .alert-item.critical {
            background: #fee2e2;
            border-color: #fecaca;
        }
        .alert-icon { font-size: 1.2rem; }
        .alert-time { font-size: 0.7rem; color: #64748b; }

        .insight-bar {
            background: linear-gradient(135deg, #ffedd5, #fed7aa);
            border: 1px solid #fdba74;
            border-radius: 10px;
            padding: 14px 16px;
            margin-top: 16px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .insight-icon { font-size: 1.2rem; }
        .insight-content { flex: 1; }
        .insight-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: #9a3412;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        .insight-text { font-size: 0.85rem; color: #7c2d12; }

        @media (max-width: 900px) {
            .start-banner { flex-direction: column; text-align: center; padding: 20px; }
            .start-banner-steps { justify-content: center; }
            .main-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Drift Detection Playground</h1>
                <span class="header-subtitle">Monitor model health in production</span>
            </div>
            <button class="reset-btn" onclick="resetPlayground()">â†» Reset</button>
        </header>

        <div class="start-banner">
            <div class="start-banner-icon">ðŸ“Š</div>
            <div class="start-banner-content">
                <h2>Production Monitoring Simulator</h2>
                <p>Watch how data drift affects model performance over time. Adjust drift intensity to see alert triggers.</p>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <span class="control-label">Data Drift:</span>
                <input type="range" id="driftSlider" min="0" max="100" value="0" onchange="updateDrift()">
                <span class="control-value" id="driftValue">0%</span>
            </div>
            <div class="control-group">
                <span class="control-label">Concept Drift:</span>
                <input type="range" id="conceptSlider" min="0" max="100" value="0" onchange="updateDrift()">
                <span class="control-value" id="conceptValue">0%</span>
            </div>
            <button class="btn btn-primary" onclick="simulateDay()">Simulate Day</button>
            <button class="btn btn-secondary" onclick="autoSimulate()">Auto Run</button>
        </div>

        <div class="main-grid">
            <div class="panel">
                <div class="panel-title">
                    <span>Performance Over Time</span>
                    <span class="panel-badge badge-healthy" id="statusBadge">Healthy</span>
                </div>
                
                <div class="chart-container">
                    <canvas id="accuracyChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <canvas id="driftChart"></canvas>
                </div>
            </div>

            <div>
                <div class="panel" style="margin-bottom: 16px;">
                    <div class="panel-title">
                        <span>Current Metrics</span>
                        <span class="panel-badge" id="dayBadge">Day 0</span>
                    </div>
                    
                    <div class="metric-grid">
                        <div class="metric-card" id="accuracyCard">
                            <div class="metric-value good" id="accuracyValue">85%</div>
                            <div class="metric-label">Accuracy</div>
                        </div>
                        <div class="metric-card" id="psiCard">
                            <div class="metric-value good" id="psiValue">0.02</div>
                            <div class="metric-label">PSI</div>
                        </div>
                        <div class="metric-card" id="predMeanCard">
                            <div class="metric-value good" id="predMeanValue">0.23</div>
                            <div class="metric-label">Pred Mean</div>
                        </div>
                        <div class="metric-card" id="volumeCard">
                            <div class="metric-value" id="volumeValue">1,000</div>
                            <div class="metric-label">Daily Volume</div>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">
                        <span>Alerts</span>
                        <span class="panel-badge badge-healthy" id="alertCount">0 active</span>
                    </div>
                    
                    <div class="alert-list" id="alertList">
                        <div style="text-align: center; color: #64748b; padding: 20px; font-size: 0.85rem;">
                            No alerts yet. Increase drift to trigger alerts.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="insight-bar">
            <div class="insight-icon">ðŸ’¡</div>
            <div class="insight-content">
                <div class="insight-title">Monitoring Insight</div>
                <div class="insight-text" id="insightText">Start by increasing the drift sliders to see how data and concept drift affect model performance over time.</div>
            </div>
        </div>
    </div>

    <script>
        let day = 0;
        let accuracyHistory = [0.85];
        let psiHistory = [0.02];
        let alerts = [];
        let autoRunning = false;

        const baselineAccuracy = 0.85;
        const baselinePSI = 0.02;
        const baselinePredMean = 0.23;

        function updateDrift() {
            document.getElementById('driftValue').textContent = document.getElementById('driftSlider').value + '%';
            document.getElementById('conceptValue').textContent = document.getElementById('conceptSlider').value + '%';
        }

        function simulateDay() {
            day++;
            document.getElementById('dayBadge').textContent = `Day ${day}`;
            
            const dataDrift = parseInt(document.getElementById('driftSlider').value) / 100;
            const conceptDrift = parseInt(document.getElementById('conceptSlider').value) / 100;
            
            // Calculate new metrics
            const noise = (Math.random() - 0.5) * 0.02;
            const newAccuracy = Math.max(0.5, baselineAccuracy - conceptDrift * 0.3 + noise);
            const newPSI = Math.min(0.5, baselinePSI + dataDrift * 0.4 + Math.random() * 0.02);
            const newPredMean = baselinePredMean + (dataDrift * 0.15) + (conceptDrift * 0.1);
            
            accuracyHistory.push(newAccuracy);
            psiHistory.push(newPSI);
            
            // Keep last 30 days
            if (accuracyHistory.length > 30) {
                accuracyHistory.shift();
                psiHistory.shift();
            }
            
            // Update display
            updateMetrics(newAccuracy, newPSI, newPredMean);
            checkAlerts(newAccuracy, newPSI);
            drawCharts();
            updateInsight(newAccuracy, newPSI);
        }

        function updateMetrics(accuracy, psi, predMean) {
            const accEl = document.getElementById('accuracyValue');
            accEl.textContent = (accuracy * 100).toFixed(0) + '%';
            accEl.className = 'metric-value ' + (accuracy > 0.8 ? 'good' : accuracy > 0.7 ? 'warning' : 'bad');
            document.getElementById('accuracyCard').className = 'metric-card' + (accuracy < 0.75 ? ' alert' : accuracy < 0.8 ? ' warning' : '');
            
            const psiEl = document.getElementById('psiValue');
            psiEl.textContent = psi.toFixed(2);
            psiEl.className = 'metric-value ' + (psi < 0.1 ? 'good' : psi < 0.25 ? 'warning' : 'bad');
            document.getElementById('psiCard').className = 'metric-card' + (psi > 0.25 ? ' alert' : psi > 0.1 ? ' warning' : '');
            
            document.getElementById('predMeanValue').textContent = predMean.toFixed(2);
            document.getElementById('volumeValue').textContent = (900 + Math.floor(Math.random() * 200)).toLocaleString();
            
            // Update status badge
            const badge = document.getElementById('statusBadge');
            if (accuracy < 0.75 || psi > 0.25) {
                badge.textContent = 'Critical';
                badge.className = 'panel-badge badge-critical';
            } else if (accuracy < 0.8 || psi > 0.1) {
                badge.textContent = 'Warning';
                badge.className = 'panel-badge badge-warning';
            } else {
                badge.textContent = 'Healthy';
                badge.className = 'panel-badge badge-healthy';
            }
        }

        function checkAlerts(accuracy, psi) {
            const newAlerts = [];
            
            if (accuracy < 0.75) {
                newAlerts.push({
                    level: 'critical',
                    icon: 'ðŸš¨',
                    message: `Accuracy dropped to ${(accuracy * 100).toFixed(0)}%`,
                    time: `Day ${day}`
                });
            } else if (accuracy < 0.8) {
                newAlerts.push({
                    level: 'warning',
                    icon: 'âš ï¸',
                    message: `Accuracy at ${(accuracy * 100).toFixed(0)}%`,
                    time: `Day ${day}`
                });
            }
            
            if (psi > 0.25) {
                newAlerts.push({
                    level: 'critical',
                    icon: 'ðŸš¨',
                    message: `Significant drift detected (PSI: ${psi.toFixed(2)})`,
                    time: `Day ${day}`
                });
            } else if (psi > 0.1) {
                newAlerts.push({
                    level: 'warning',
                    icon: 'âš ï¸',
                    message: `Moderate drift (PSI: ${psi.toFixed(2)})`,
                    time: `Day ${day}`
                });
            }
            
            if (newAlerts.length > 0) {
                alerts = [...newAlerts, ...alerts].slice(0, 10);
                renderAlerts();
            }
            
            const countBadge = document.getElementById('alertCount');
            const activeCount = alerts.filter(a => a.level === 'critical').length;
            countBadge.textContent = activeCount > 0 ? `${activeCount} critical` : '0 active';
            countBadge.className = 'panel-badge ' + (activeCount > 0 ? 'badge-critical' : 'badge-healthy');
        }

        function renderAlerts() {
            const list = document.getElementById('alertList');
            if (alerts.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #64748b; padding: 20px; font-size: 0.85rem;">No alerts yet.</div>';
                return;
            }
            
            list.innerHTML = alerts.map(a => `
                <div class="alert-item ${a.level}">
                    <span class="alert-icon">${a.icon}</span>
                    <div style="flex: 1;">
                        <div>${a.message}</div>
                        <div class="alert-time">${a.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function drawCharts() {
            // Accuracy chart
            const accCanvas = document.getElementById('accuracyChart');
            const accCtx = accCanvas.getContext('2d');
            accCanvas.width = accCanvas.offsetWidth * 2;
            accCanvas.height = accCanvas.offsetHeight * 2;
            accCtx.scale(2, 2);
            
            const width = accCanvas.offsetWidth;
            const height = accCanvas.offsetHeight;
            
            accCtx.clearRect(0, 0, width, height);
            
            // Draw accuracy line
            accCtx.beginPath();
            accCtx.strokeStyle = '#10b981';
            accCtx.lineWidth = 2;
            
            const xStep = width / Math.max(accuracyHistory.length - 1, 1);
            accuracyHistory.forEach((val, i) => {
                const x = i * xStep;
                const y = height - (val - 0.5) * height / 0.5;
                if (i === 0) accCtx.moveTo(x, y);
                else accCtx.lineTo(x, y);
            });
            accCtx.stroke();
            
            // Threshold line
            accCtx.beginPath();
            accCtx.strokeStyle = '#ef4444';
            accCtx.setLineDash([5, 5]);
            const thresholdY = height - (0.75 - 0.5) * height / 0.5;
            accCtx.moveTo(0, thresholdY);
            accCtx.lineTo(width, thresholdY);
            accCtx.stroke();
            accCtx.setLineDash([]);
            
            // Labels
            accCtx.fillStyle = '#64748b';
            accCtx.font = '10px sans-serif';
            accCtx.fillText('Accuracy', 5, 12);
            accCtx.fillText('75% threshold', 5, thresholdY - 5);
            
            // PSI chart
            const psiCanvas = document.getElementById('driftChart');
            const psiCtx = psiCanvas.getContext('2d');
            psiCanvas.width = psiCanvas.offsetWidth * 2;
            psiCanvas.height = psiCanvas.offsetHeight * 2;
            psiCtx.scale(2, 2);
            
            const psiWidth = psiCanvas.offsetWidth;
            const psiHeight = psiCanvas.offsetHeight;
            
            psiCtx.clearRect(0, 0, psiWidth, psiHeight);
            
            // Draw PSI bars
            const barWidth = Math.max(1, psiWidth / Math.max(psiHistory.length, 1) - 2);
            psiHistory.forEach((val, i) => {
                const x = i * (barWidth + 2);
                const barHeight = val * psiHeight / 0.5;
                const y = psiHeight - barHeight;
                
                psiCtx.fillStyle = val > 0.25 ? '#ef4444' : val > 0.1 ? '#f59e0b' : '#10b981';
                psiCtx.fillRect(x, y, barWidth, barHeight);
            });
            
            // Threshold lines
            psiCtx.beginPath();
            psiCtx.strokeStyle = '#f59e0b';
            psiCtx.setLineDash([5, 5]);
            const warn = psiHeight - 0.1 * psiHeight / 0.5;
            psiCtx.moveTo(0, warn);
            psiCtx.lineTo(psiWidth, warn);
            psiCtx.stroke();
            
            psiCtx.strokeStyle = '#ef4444';
            const crit = psiHeight - 0.25 * psiHeight / 0.5;
            psiCtx.moveTo(0, crit);
            psiCtx.lineTo(psiWidth, crit);
            psiCtx.stroke();
            psiCtx.setLineDash([]);
            
            psiCtx.fillStyle = '#64748b';
            psiCtx.fillText('PSI (Drift)', 5, 12);
        }

        function updateInsight(accuracy, psi) {
            let insight = '';
            
            if (accuracy < 0.75 && psi > 0.25) {
                insight = 'ðŸš¨ Critical: Both accuracy and drift are in dangerous territory. Consider retraining immediately with recent data.';
            } else if (accuracy < 0.75) {
                insight = 'âš ï¸ Concept drift detected: Model accuracy has dropped significantly. The relationship between features and target may have changed.';
            } else if (psi > 0.25) {
                insight = 'âš ï¸ Data drift detected: Input distribution has shifted significantly. Monitor accuracy closely.';
            } else if (psi > 0.1) {
                insight = 'Moderate drift detected. Keep monitoring-may need to retrain if accuracy starts dropping.';
            } else if (accuracy < 0.8) {
                insight = 'Slight accuracy degradation. Worth investigating recent data quality and feature distributions.';
            } else {
                insight = 'Model is healthy. Continue monitoring for changes.';
            }
            
            document.getElementById('insightText').textContent = insight;
        }

        let autoInterval = null;
        function autoSimulate() {
            if (autoRunning) {
                clearInterval(autoInterval);
                autoRunning = false;
            } else {
                autoRunning = true;
                autoInterval = setInterval(simulateDay, 500);
            }
        }

        function resetPlayground() {
            day = 0;
            accuracyHistory = [0.85];
            psiHistory = [0.02];
            alerts = [];
            
            if (autoInterval) {
                clearInterval(autoInterval);
                autoRunning = false;
            }
            
            document.getElementById('driftSlider').value = 0;
            document.getElementById('conceptSlider').value = 0;
            updateDrift();
            
            document.getElementById('dayBadge').textContent = 'Day 0';
            updateMetrics(0.85, 0.02, 0.23);
            renderAlerts();
            drawCharts();
            document.getElementById('insightText').textContent = 
                'Start by increasing the drift sliders to see how data and concept drift affect model performance over time.';
        }

        // Initialize
        drawCharts();
        
        // Handle window resize
        window.addEventListener('resize', drawCharts);
    </script>
</body>
</html>
