<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drift Detection Playground</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        h1 { font-size: 1.4rem; color: #0f172a; margin-bottom: 4px; }
        .header-subtitle { font-size: 0.85rem; color: #64748b; }

        .reset-btn {
            background: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .reset-btn:hover { background: #f1f5f9; }

        .start-banner {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-radius: 14px;
            padding: 20px 28px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .start-banner-icon { font-size: 2.2rem; }
        .start-banner-content h2 { font-size: 1rem; margin-bottom: 6px; }
        .start-banner-content p { font-size: 0.85rem; opacity: 0.9; }

        .controls {
            background: white;
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .control-label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
        }
        .slider-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="range"] {
            width: 150px;
        }
        .slider-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            min-width: 30px;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #f59e0b;
            color: white;
        }
        .btn-primary:hover { background: #d97706; }
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }
        .btn-secondary:hover { background: #e2e8f0; }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .panel-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-container {
            height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .distribution {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 100%;
            padding: 10px;
        }
        .bar {
            width: 20px;
            background: #6366f1;
            border-radius: 3px 3px 0 0;
            transition: height 0.3s;
        }
        .bar.production {
            background: #f59e0b;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8fafc;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .metric-label { font-size: 0.85rem; color: #64748b; }
        .metric-value { font-size: 1rem; font-weight: 600; color: #1e293b; }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-healthy { background: #dcfce7; color: #16a34a; }
        .status-warning { background: #fef3c7; color: #d97706; }
        .status-critical { background: #fee2e2; color: #dc2626; }

        .alert-list {
            max-height: 200px;
            overflow-y: auto;
        }
        .alert-item {
            display: flex;
            gap: 10px;
            padding: 10px 12px;
            background: #f8fafc;
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        .alert-icon { font-size: 1rem; }
        .alert-content { flex: 1; }
        .alert-time { color: #64748b; font-size: 0.75rem; }
        .alert-warning { border-left: 3px solid #f59e0b; }
        .alert-critical { border-left: 3px solid #dc2626; }

        .timeline {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
        }
        .timeline-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            cursor: pointer;
        }
        .timeline-bar.healthy { background: #10b981; }
        .timeline-bar.warning { background: #f59e0b; }
        .timeline-bar.critical { background: #ef4444; }
        .timeline-bar.active { outline: 2px solid #1e293b; }

        .insight-bar {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #fcd34d;
            border-radius: 10px;
            padding: 14px 16px;
            margin-top: 16px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .insight-icon { font-size: 1.2rem; }
        .insight-content { flex: 1; }
        .insight-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: #92400e;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        .insight-text { font-size: 0.85rem; color: #78350f; }

        .legend {
            display: flex;
            gap: 16px;
            font-size: 0.75rem;
            margin-top: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Drift Detection Playground</h1>
                <span class="header-subtitle">Watch models degrade over time</span>
            </div>
            <button class="reset-btn" onclick="resetSimulation()">‚Üª Reset</button>
        </header>

        <div class="start-banner">
            <div class="start-banner-icon">üìâ</div>
            <div class="start-banner-content">
                <h2>Model Monitoring Simulator</h2>
                <p>Simulate data drift and watch how it affects model performance.</p>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <span class="control-label">Data Drift Amount</span>
                <div class="slider-row">
                    <input type="range" id="driftAmount" min="0" max="100" value="0" oninput="updateDrift()">
                    <span class="slider-value" id="driftValue">0%</span>
                </div>
            </div>
            <div class="control-group">
                <span class="control-label">Concept Drift</span>
                <div class="slider-row">
                    <input type="range" id="conceptDrift" min="0" max="100" value="0" oninput="updateConcept()">
                    <span class="slider-value" id="conceptValue">0%</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="simulateTime()">‚ñ∂ Advance Time</button>
            <button class="btn btn-secondary" onclick="autoSimulate()">‚è© Auto-Simulate</button>
        </div>

        <div class="panel" style="margin-bottom: 16px;">
            <div class="panel-title">
                <span>Timeline (30 days)</span>
                <span class="status-badge" id="overallStatus">Healthy</span>
            </div>
            <div class="timeline" id="timeline"></div>
            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #64748b;">
                <span>Day 1</span>
                <span>Day 15</span>
                <span>Day 30</span>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <div class="panel-title">
                    <span>Feature Distribution: Age</span>
                    <span class="status-badge" id="featureStatus">No Drift</span>
                </div>
                <div class="chart-container">
                    <div class="distribution" id="featureChart"></div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #6366f1;"></div>
                        <span>Training</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f59e0b;"></div>
                        <span>Production</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">
                    <span>Model Metrics</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Accuracy</span>
                    <span class="metric-value" id="accuracy">85.0%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">PSI Score</span>
                    <span class="metric-value" id="psi">0.00</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Prediction Mean</span>
                    <span class="metric-value" id="predMean">0.32</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Days Since Retrain</span>
                    <span class="metric-value" id="daysSince">0</span>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">
                    <span>Alerts</span>
                    <span class="status-badge status-healthy" id="alertCount">0 Active</span>
                </div>
                <div class="alert-list" id="alertList">
                    <div style="text-align: center; color: #64748b; padding: 20px;">
                        No alerts - system healthy
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">
                    <span>Recommendations</span>
                </div>
                <div id="recommendations" style="font-size: 0.9rem; line-height: 1.8;">
                    <div style="color: #16a34a;">‚úì Model is healthy</div>
                    <div style="color: #16a34a;">‚úì No retraining needed</div>
                    <div style="color: #16a34a;">‚úì Data distribution stable</div>
                </div>
            </div>
        </div>

        <div class="insight-bar">
            <div class="insight-icon">üí°</div>
            <div class="insight-content">
                <div class="insight-title">Monitoring Insight</div>
                <div class="insight-text" id="insightText">Adjust the drift sliders and advance time to see how drift affects model performance. Watch for alerts as metrics degrade.</div>
            </div>
        </div>
    </div>

    <script>
        let state = {
            day: 0,
            dataDrift: 0,
            conceptDrift: 0,
            accuracy: 85,
            psi: 0,
            predMean: 0.32,
            alerts: [],
            timeline: []
        };

        const trainingDist = [5, 8, 12, 18, 22, 25, 22, 18, 12, 8, 5];

        function initTimeline() {
            const container = document.getElementById('timeline');
            container.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const bar = document.createElement('div');
                bar.className = 'timeline-bar';
                bar.onclick = () => selectDay(i);
                container.appendChild(bar);
            }
        }

        function updateFeatureChart() {
            const container = document.getElementById('featureChart');
            container.innerHTML = '';
            
            const driftFactor = state.dataDrift / 100;
            
            for (let i = 0; i < trainingDist.length; i++) {
                const trainHeight = trainingDist[i] * 6;
                
                // Shift distribution based on drift
                const shiftedIndex = Math.min(trainingDist.length - 1, Math.max(0, 
                    Math.round(i + driftFactor * 3)));
                const prodHeight = trainingDist[shiftedIndex] * 6 * (1 + driftFactor * 0.3);
                
                const group = document.createElement('div');
                group.style.display = 'flex';
                group.style.gap = '2px';
                group.style.alignItems = 'flex-end';
                
                const trainBar = document.createElement('div');
                trainBar.className = 'bar';
                trainBar.style.height = `${trainHeight}px`;
                
                const prodBar = document.createElement('div');
                prodBar.className = 'bar production';
                prodBar.style.height = `${prodHeight}px`;
                
                group.appendChild(trainBar);
                group.appendChild(prodBar);
                container.appendChild(group);
            }
        }

        function updateDrift() {
            state.dataDrift = parseInt(document.getElementById('driftAmount').value);
            document.getElementById('driftValue').textContent = state.dataDrift + '%';
            calculateMetrics();
            updateUI();
        }

        function updateConcept() {
            state.conceptDrift = parseInt(document.getElementById('conceptDrift').value);
            document.getElementById('conceptValue').textContent = state.conceptDrift + '%';
            calculateMetrics();
            updateUI();
        }

        function calculateMetrics() {
            // PSI based on data drift
            state.psi = state.dataDrift * 0.004;
            
            // Accuracy drops with concept drift
            state.accuracy = Math.max(50, 85 - state.conceptDrift * 0.35);
            
            // Prediction mean shifts with data drift
            state.predMean = 0.32 + state.dataDrift * 0.003;
        }

        function checkAlerts() {
            const newAlerts = [];
            
            if (state.psi > 0.25) {
                newAlerts.push({
                    type: 'critical',
                    icon: 'üö®',
                    message: 'Critical: PSI > 0.25 - Significant drift detected',
                    time: `Day ${state.day}`
                });
            } else if (state.psi > 0.1) {
                newAlerts.push({
                    type: 'warning',
                    icon: '‚ö†Ô∏è',
                    message: 'Warning: PSI > 0.1 - Moderate drift detected',
                    time: `Day ${state.day}`
                });
            }
            
            if (state.accuracy < 75) {
                newAlerts.push({
                    type: 'critical',
                    icon: 'üö®',
                    message: `Critical: Accuracy dropped to ${state.accuracy.toFixed(1)}%`,
                    time: `Day ${state.day}`
                });
            } else if (state.accuracy < 80) {
                newAlerts.push({
                    type: 'warning',
                    icon: '‚ö†Ô∏è',
                    message: `Warning: Accuracy at ${state.accuracy.toFixed(1)}%`,
                    time: `Day ${state.day}`
                });
            }
            
            if (state.day > 14) {
                newAlerts.push({
                    type: 'warning',
                    icon: 'üìÖ',
                    message: 'Time-based: Consider scheduled retrain',
                    time: `Day ${state.day}`
                });
            }
            
            return newAlerts;
        }

        function simulateTime() {
            if (state.day >= 30) return;
            
            state.day++;
            
            // Auto-increase drift over time
            state.dataDrift = Math.min(100, state.dataDrift + 2);
            state.conceptDrift = Math.min(100, state.conceptDrift + 1);
            
            document.getElementById('driftAmount').value = state.dataDrift;
            document.getElementById('driftValue').textContent = state.dataDrift + '%';
            document.getElementById('conceptDrift').value = state.conceptDrift;
            document.getElementById('conceptValue').textContent = state.conceptDrift + '%';
            
            calculateMetrics();
            
            // Determine day status
            let dayStatus = 'healthy';
            if (state.psi > 0.25 || state.accuracy < 75) dayStatus = 'critical';
            else if (state.psi > 0.1 || state.accuracy < 80) dayStatus = 'warning';
            
            state.timeline.push(dayStatus);
            
            // Update timeline visual
            const bars = document.querySelectorAll('.timeline-bar');
            if (bars[state.day - 1]) {
                bars[state.day - 1].className = `timeline-bar ${dayStatus}`;
            }
            
            state.alerts = checkAlerts();
            updateUI();
            
            // Update insight
            if (state.accuracy < 75) {
                document.getElementById('insightText').textContent = 
                    'Critical accuracy drop! The model is making significantly worse predictions. Immediate retraining recommended.';
            } else if (state.psi > 0.25) {
                document.getElementById('insightText').textContent = 
                    'Significant data drift detected. The production data looks very different from training data. Investigate the cause.';
            } else if (state.day > 14) {
                document.getElementById('insightText').textContent = 
                    'Model has been running for ' + state.day + ' days. Consider a scheduled retrain to incorporate recent patterns.';
            }
        }

        let autoInterval = null;
        function autoSimulate() {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
                return;
            }
            autoInterval = setInterval(() => {
                if (state.day >= 30) {
                    clearInterval(autoInterval);
                    autoInterval = null;
                    return;
                }
                simulateTime();
            }, 500);
        }

        function updateUI() {
            updateFeatureChart();
            
            // Update metrics
            document.getElementById('accuracy').textContent = state.accuracy.toFixed(1) + '%';
            document.getElementById('psi').textContent = state.psi.toFixed(2);
            document.getElementById('predMean').textContent = state.predMean.toFixed(2);
            document.getElementById('daysSince').textContent = state.day;
            
            // Update feature status
            const featureStatus = document.getElementById('featureStatus');
            if (state.psi > 0.25) {
                featureStatus.textContent = 'High Drift';
                featureStatus.className = 'status-badge status-critical';
            } else if (state.psi > 0.1) {
                featureStatus.textContent = 'Moderate Drift';
                featureStatus.className = 'status-badge status-warning';
            } else {
                featureStatus.textContent = 'No Drift';
                featureStatus.className = 'status-badge status-healthy';
            }
            
            // Update overall status
            const overallStatus = document.getElementById('overallStatus');
            if (state.accuracy < 75 || state.psi > 0.25) {
                overallStatus.textContent = 'Critical';
                overallStatus.className = 'status-badge status-critical';
            } else if (state.accuracy < 80 || state.psi > 0.1) {
                overallStatus.textContent = 'Warning';
                overallStatus.className = 'status-badge status-warning';
            } else {
                overallStatus.textContent = 'Healthy';
                overallStatus.className = 'status-badge status-healthy';
            }
            
            // Update alerts
            const alertList = document.getElementById('alertList');
            const alertCount = document.getElementById('alertCount');
            
            if (state.alerts.length === 0) {
                alertList.innerHTML = '<div style="text-align: center; color: #64748b; padding: 20px;">No alerts - system healthy</div>';
                alertCount.textContent = '0 Active';
                alertCount.className = 'status-badge status-healthy';
            } else {
                alertList.innerHTML = state.alerts.map(alert => `
                    <div class="alert-item alert-${alert.type}">
                        <span class="alert-icon">${alert.icon}</span>
                        <div class="alert-content">
                            <div>${alert.message}</div>
                            <div class="alert-time">${alert.time}</div>
                        </div>
                    </div>
                `).join('');
                alertCount.textContent = state.alerts.length + ' Active';
                alertCount.className = state.alerts.some(a => a.type === 'critical') 
                    ? 'status-badge status-critical' 
                    : 'status-badge status-warning';
            }
            
            // Update recommendations
            const recs = document.getElementById('recommendations');
            const items = [];
            
            if (state.accuracy < 80) {
                items.push('<div style="color: #dc2626;">‚úó Retrain model - accuracy has dropped</div>');
            } else {
                items.push('<div style="color: #16a34a;">‚úì Accuracy acceptable</div>');
            }
            
            if (state.psi > 0.1) {
                items.push('<div style="color: #d97706;">‚ö† Investigate data drift cause</div>');
            } else {
                items.push('<div style="color: #16a34a;">‚úì Data distribution stable</div>');
            }
            
            if (state.day > 14) {
                items.push('<div style="color: #d97706;">‚ö† Consider scheduled retrain</div>');
            } else {
                items.push('<div style="color: #16a34a;">‚úì Recent training</div>');
            }
            
            recs.innerHTML = items.join('');
        }

        function resetSimulation() {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
            }
            
            state = {
                day: 0,
                dataDrift: 0,
                conceptDrift: 0,
                accuracy: 85,
                psi: 0,
                predMean: 0.32,
                alerts: [],
                timeline: []
            };
            
            document.getElementById('driftAmount').value = 0;
            document.getElementById('driftValue').textContent = '0%';
            document.getElementById('conceptDrift').value = 0;
            document.getElementById('conceptValue').textContent = '0%';
            
            initTimeline();
            updateUI();
            
            document.getElementById('insightText').textContent = 
                'Adjust the drift sliders and advance time to see how drift affects model performance. Watch for alerts as metrics degrade.';
        }

        // Initialize
        initTimeline();
        updateUI();
    </script>
</body>
</html>
