<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regularization Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        h1 { font-size: 1.5rem; color: #0f172a; margin-bottom: 4px; }
        .header-subtitle { font-size: 0.9rem; color: #64748b; }

        .reset-btn {
            background: white;
            color: #64748b;
            border: 1px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .reset-btn:hover { background: #f1f5f9; color: #475569; }

        .start-banner {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
        }
        .start-banner-icon { font-size: 2.5rem; flex-shrink: 0; }
        .start-banner-content h2 { font-size: 1.1rem; margin-bottom: 8px; font-weight: 600; }
        .start-banner-content p { font-size: 0.85rem; opacity: 0.9; margin-bottom: 12px; }
        .start-banner-steps { display: flex; gap: 24px; flex-wrap: wrap; }
        .start-step { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; }
        .step-num {
            background: rgba(255,255,255,0.2);
            width: 24px; height: 24px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 0.75rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 16px;
            margin-bottom: 24px;
        }

        .charts-area { display: flex; flex-direction: column; gap: 12px; }

        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .chart-title { font-size: 0.75rem; font-weight: 600; color: #475569; }
        .chart-badge {
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #f1f5f9;
            color: #64748b;
        }

        canvas { display: block; width: 100%; }

        .sidebar { display: flex; flex-direction: column; gap: 12px; }

        .sidebar-card {
            background: white;
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .sidebar-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .control-group { margin-bottom: 12px; }
        .control-group:last-child { margin-bottom: 0; }
        .control-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            font-weight: 500;
            color: #334155;
            margin-bottom: 6px;
        }
        .control-value {
            font-family: 'SF Mono', Monaco, monospace;
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            color: #f97316;
        }

        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
        }

        input[type="range"] {
            width: 100%;
            height: 5px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px; height: 14px;
            border-radius: 50%;
            background: #f97316;
            cursor: pointer;
        }

        .coef-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
        }
        .coef-bar {
            height: 60px;
            background: #e2e8f0;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .coef-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0ea5e9;
            transition: height 0.3s;
        }
        .coef-fill.negative { background: #ef4444; }
        .coef-fill.zero { background: #94a3b8; }
        .coef-label {
            text-align: center;
            font-size: 0.6rem;
            color: #64748b;
            margin-top: 2px;
        }
        .coef-value {
            text-align: center;
            font-size: 0.65rem;
            font-weight: 600;
            color: #1e293b;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .metrics-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .metric-card {
            padding: 10px;
            background: #f8fafc;
            border-radius: 6px;
            text-align: center;
        }
        .metric-card.highlight {
            background: #fff7ed;
            border: 1px solid #fed7aa;
        }
        .metric-name {
            font-size: 0.65rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
        }
        .metric-value {
            font-size: 1rem;
            font-weight: 700;
            color: #ea580c;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .insight-bar {
            background: linear-gradient(135deg, #fff7ed, #ffedd5);
            border: 1px solid #fed7aa;
            border-radius: 10px;
            padding: 14px 16px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .insight-icon { font-size: 1.2rem; }
        .insight-content { flex: 1; }
        .insight-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: #c2410c;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        .insight-text { font-size: 0.85rem; color: #9a3412; }

        @media (max-width: 1000px) {
            .start-banner { flex-direction: column; text-align: center; padding: 20px; }
            .start-banner-steps { justify-content: center; }
            .main-grid { grid-template-columns: 1fr; }
            .chart-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Regularization Playground</h1>
                <span class="header-subtitle">See how L1 and L2 regularization affect coefficients and generalization</span>
            </div>
            <button class="reset-btn" onclick="resetPlayground()">‚Üª Reset</button>
        </header>

        <div class="start-banner">
            <div class="start-banner-icon">‚öñÔ∏è</div>
            <div class="start-banner-content">
                <h2>The Bias-Variance Tradeoff</h2>
                <p>Regularization constrains model complexity. Find the sweet spot between underfitting and overfitting.</p>
                <div class="start-banner-steps">
                    <div class="start-step"><span class="step-num">1</span> Watch L1 zero out coefficients</div>
                    <div class="start-step"><span class="step-num">2</span> See L2 shrink but keep all</div>
                    <div class="start-step"><span class="step-num">3</span> Find optimal Œª</div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="charts-area">
                <div class="chart-row">
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">Train vs Test Error</span>
                            <span class="chart-badge">gap = overfit</span>
                        </div>
                        <canvas id="errorChart" height="200"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">Coefficient Paths</span>
                            <span class="chart-badge" id="regTypeBadge">L2</span>
                        </div>
                        <canvas id="pathChart" height="200"></canvas>
                    </div>
                </div>

                <div class="chart-row">
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">Feature Coefficients</span>
                            <span class="chart-badge" id="nonzeroCount">10/10 non-zero</span>
                        </div>
                        <div class="coef-grid" id="coefGrid"></div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <span class="chart-title">Prediction Fit</span>
                        </div>
                        <canvas id="fitChart" height="180"></canvas>
                    </div>
                </div>

                <div class="insight-bar">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-content">
                        <div class="insight-title">Regularization Insight</div>
                        <div class="insight-text" id="insightText">Adjust lambda to see how regularization affects the model.</div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="sidebar-card">
                    <div class="sidebar-title">Regularization</div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Type</span>
                        </div>
                        <select id="regType" onchange="updateAll()">
                            <option value="l2">L2 (Ridge)</option>
                            <option value="l1">L1 (Lasso)</option>
                            <option value="elastic">Elastic Net</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Lambda (Œª)</span>
                            <span class="control-value" id="lambdaValue">1.0</span>
                        </div>
                        <input type="range" id="lambdaSlider" min="-3" max="3" step="0.1" value="0" oninput="updateAll()">
                    </div>
                </div>

                <div class="sidebar-card">
                    <div class="sidebar-title">Data</div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Sample Size</span>
                            <span class="control-value" id="nSamplesValue">100</span>
                        </div>
                        <input type="range" id="nSamplesSlider" min="50" max="500" step="50" value="100" oninput="updateAll()">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>Noise Level</span>
                            <span class="control-value" id="noiseValue">0.5</span>
                        </div>
                        <input type="range" id="noiseSlider" min="0" max="2" step="0.1" value="0.5" oninput="updateAll()">
                    </div>
                    <div class="control-group">
                        <div class="control-label">
                            <span>True Features</span>
                            <span class="control-value" id="trueFeatValue">5</span>
                        </div>
                        <input type="range" id="trueFeatSlider" min="1" max="10" step="1" value="5" oninput="updateAll()">
                    </div>
                </div>

                <div class="sidebar-card">
                    <div class="sidebar-title">Metrics</div>
                    <div class="metrics-panel">
                        <div class="metric-card highlight">
                            <div class="metric-name">Train MSE</div>
                            <div class="metric-value" id="trainMse">--</div>
                        </div>
                        <div class="metric-card highlight">
                            <div class="metric-name">Test MSE</div>
                            <div class="metric-value" id="testMse">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">Overfit Gap</div>
                            <div class="metric-value" id="gapValue">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">Non-zero</div>
                            <div class="metric-value" id="nonzeroValue">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const dpr = window.devicePixelRatio || 1;
        const nFeatures = 10;
        
        let X_train = [], y_train = [];
        let X_test = [], y_test = [];
        let trueCoefs = [];
        let currentCoefs = [];

        function setupCanvas(canvas) {
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.scale(dpr, dpr);
            return { width: rect.width, height: rect.height, ctx };
        }

        function gaussianRandom() {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        function generateData() {
            const nTrain = parseInt(document.getElementById('nSamplesSlider').value);
            const nTest = 100;
            const noise = parseFloat(document.getElementById('noiseSlider').value);
            const nTrue = parseInt(document.getElementById('trueFeatSlider').value);
            
            trueCoefs = [];
            for (let i = 0; i < nFeatures; i++) {
                trueCoefs.push(i < nTrue ? (Math.random() - 0.5) * 4 : 0);
            }
            
            X_train = [];
            y_train = [];
            for (let i = 0; i < nTrain; i++) {
                const x = [];
                let y = 0;
                for (let j = 0; j < nFeatures; j++) {
                    const xj = gaussianRandom();
                    x.push(xj);
                    y += trueCoefs[j] * xj;
                }
                y += gaussianRandom() * noise;
                X_train.push(x);
                y_train.push(y);
            }
            
            X_test = [];
            y_test = [];
            for (let i = 0; i < nTest; i++) {
                const x = [];
                let y = 0;
                for (let j = 0; j < nFeatures; j++) {
                    const xj = gaussianRandom();
                    x.push(xj);
                    y += trueCoefs[j] * xj;
                }
                y += gaussianRandom() * noise;
                X_test.push(x);
                y_test.push(y);
            }
        }

        function fitModel(lambda, regType) {
            const n = X_train.length;
            const coefs = new Array(nFeatures).fill(0);
            const lr = 0.01;
            const nIter = 1000;
            
            for (let iter = 0; iter < nIter; iter++) {
                const grad = new Array(nFeatures).fill(0);
                
                for (let i = 0; i < n; i++) {
                    let pred = 0;
                    for (let j = 0; j < nFeatures; j++) {
                        pred += coefs[j] * X_train[i][j];
                    }
                    const error = pred - y_train[i];
                    for (let j = 0; j < nFeatures; j++) {
                        grad[j] += error * X_train[i][j];
                    }
                }
                
                for (let j = 0; j < nFeatures; j++) {
                    grad[j] /= n;
                    
                    if (regType === 'l2' || regType === 'elastic') {
                        grad[j] += lambda * coefs[j];
                    }
                    
                    coefs[j] -= lr * grad[j];
                    
                    if (regType === 'l1' || regType === 'elastic') {
                        const threshold = lr * lambda * 0.5;
                        if (coefs[j] > threshold) coefs[j] -= threshold;
                        else if (coefs[j] < -threshold) coefs[j] += threshold;
                        else coefs[j] = 0;
                    }
                }
            }
            
            return coefs;
        }

        function predict(X, coefs) {
            return X.map(x => x.reduce((sum, xj, j) => sum + xj * coefs[j], 0));
        }

        function mse(y_true, y_pred) {
            return y_true.reduce((sum, y, i) => sum + (y - y_pred[i]) ** 2, 0) / y_true.length;
        }

        function drawErrorChart() {
            const canvas = document.getElementById('errorChart');
            const { width, height, ctx } = setupCanvas(canvas);
            const pad = { top: 20, right: 20, bottom: 35, left: 45 };
            const plotW = width - pad.left - pad.right;
            const plotH = height - pad.top - pad.bottom;
            
            ctx.clearRect(0, 0, width, height);
            
            const regType = document.getElementById('regType').value;
            const lambdas = [];
            const trainErrors = [];
            const testErrors = [];
            
            for (let logL = -3; logL <= 3; logL += 0.5) {
                const l = Math.pow(10, logL);
                lambdas.push(l);
                const coefs = fitModel(l, regType);
                trainErrors.push(mse(y_train, predict(X_train, coefs)));
                testErrors.push(mse(y_test, predict(X_test, coefs)));
            }
            
            const maxError = Math.max(...trainErrors, ...testErrors);
            const minError = 0;
            
            const sx = i => pad.left + (i / (lambdas.length - 1)) * plotW;
            const sy = e => pad.top + (1 - (e - minError) / (maxError - minError)) * plotH;
            
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = pad.top + (i / 4) * plotH;
                ctx.beginPath();
                ctx.moveTo(pad.left, y);
                ctx.lineTo(width - pad.right, y);
                ctx.stroke();
            }
            
            ctx.strokeStyle = '#0ea5e9';
            ctx.lineWidth = 2;
            ctx.beginPath();
            trainErrors.forEach((e, i) => {
                if (i === 0) ctx.moveTo(sx(i), sy(e));
                else ctx.lineTo(sx(i), sy(e));
            });
            ctx.stroke();
            
            ctx.strokeStyle = '#f97316';
            ctx.beginPath();
            testErrors.forEach((e, i) => {
                if (i === 0) ctx.moveTo(sx(i), sy(e));
                else ctx.lineTo(sx(i), sy(e));
            });
            ctx.stroke();
            
            const currentLambda = Math.pow(10, parseFloat(document.getElementById('lambdaSlider').value));
            const lambdaIdx = lambdas.findIndex(l => l >= currentLambda) || 0;
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(sx(lambdaIdx), pad.top);
            ctx.lineTo(sx(lambdaIdx), height - pad.bottom);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#64748b';
            ctx.font = '9px -apple-system';
            ctx.textAlign = 'center';
            ctx.fillText('Œª (log scale)', width / 2, height - 5);
            ctx.fillText('10‚Åª¬≥', pad.left, height - 18);
            ctx.fillText('10¬≥', width - pad.right, height - 18);
            
            ctx.textAlign = 'left';
            ctx.fillStyle = '#0ea5e9';
            ctx.fillText('Train', pad.left + 5, pad.top + 12);
            ctx.fillStyle = '#f97316';
            ctx.fillText('Test', pad.left + 40, pad.top + 12);
        }

        function drawPathChart() {
            const canvas = document.getElementById('pathChart');
            const { width, height, ctx } = setupCanvas(canvas);
            const pad = { top: 20, right: 20, bottom: 35, left: 45 };
            const plotW = width - pad.left - pad.right;
            const plotH = height - pad.top - pad.bottom;
            
            ctx.clearRect(0, 0, width, height);
            
            const regType = document.getElementById('regType').value;
            const paths = [];
            
            for (let j = 0; j < nFeatures; j++) paths.push([]);
            
            for (let logL = -3; logL <= 3; logL += 0.3) {
                const l = Math.pow(10, logL);
                const coefs = fitModel(l, regType);
                for (let j = 0; j < nFeatures; j++) {
                    paths[j].push(coefs[j]);
                }
            }
            
            const maxCoef = Math.max(...paths.flat().map(Math.abs), 1);
            
            const sx = i => pad.left + (i / (paths[0].length - 1)) * plotW;
            const sy = c => pad.top + (1 - (c + maxCoef) / (2 * maxCoef)) * plotH;
            
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pad.left, sy(0));
            ctx.lineTo(width - pad.right, sy(0));
            ctx.stroke();
            
            const colors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#0ea5e9', '#6366f1', '#8b5cf6', '#ec4899', '#14b8a6', '#64748b'];
            
            paths.forEach((path, j) => {
                ctx.strokeStyle = colors[j % colors.length];
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                path.forEach((c, i) => {
                    if (i === 0) ctx.moveTo(sx(i), sy(c));
                    else ctx.lineTo(sx(i), sy(c));
                });
                ctx.stroke();
            });
            
            const currentLambdaIdx = Math.floor((parseFloat(document.getElementById('lambdaSlider').value) + 3) / 0.3);
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(sx(currentLambdaIdx), pad.top);
            ctx.lineTo(sx(currentLambdaIdx), height - pad.bottom);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#64748b';
            ctx.font = '9px -apple-system';
            ctx.textAlign = 'center';
            ctx.fillText('Œª ‚Üí', width / 2, height - 5);
            
            document.getElementById('regTypeBadge').textContent = regType === 'none' ? 'No reg' : regType.toUpperCase();
        }

        function drawCoefGrid() {
            const grid = document.getElementById('coefGrid');
            grid.innerHTML = '';
            
            const maxCoef = Math.max(...currentCoefs.map(Math.abs), 1);
            let nonzero = 0;
            
            currentCoefs.forEach((c, i) => {
                const div = document.createElement('div');
                div.style.textAlign = 'center';
                
                const bar = document.createElement('div');
                bar.className = 'coef-bar';
                
                const fill = document.createElement('div');
                fill.className = 'coef-fill';
                const h = Math.abs(c) / maxCoef * 100;
                fill.style.height = h + '%';
                
                if (Math.abs(c) < 0.01) {
                    fill.classList.add('zero');
                } else if (c < 0) {
                    fill.classList.add('negative');
                    nonzero++;
                } else {
                    nonzero++;
                }
                
                bar.appendChild(fill);
                div.appendChild(bar);
                
                const label = document.createElement('div');
                label.className = 'coef-label';
                label.textContent = `X${i+1}`;
                div.appendChild(label);
                
                const value = document.createElement('div');
                value.className = 'coef-value';
                value.textContent = c.toFixed(2);
                div.appendChild(value);
                
                grid.appendChild(div);
            });
            
            document.getElementById('nonzeroCount').textContent = `${nonzero}/${nFeatures} non-zero`;
            document.getElementById('nonzeroValue').textContent = `${nonzero}/${nFeatures}`;
        }

        function drawFitChart() {
            const canvas = document.getElementById('fitChart');
            const { width, height, ctx } = setupCanvas(canvas);
            const pad = { top: 15, right: 15, bottom: 30, left: 40 };
            const plotW = width - pad.left - pad.right;
            const plotH = height - pad.top - pad.bottom;
            
            ctx.clearRect(0, 0, width, height);
            
            const y_pred = predict(X_test, currentCoefs);
            const allY = [...y_test, ...y_pred];
            const minY = Math.min(...allY);
            const maxY = Math.max(...allY);
            
            const sx = y => pad.left + ((y - minY) / (maxY - minY)) * plotW;
            const sy = y => pad.top + (1 - (y - minY) / (maxY - minY)) * plotH;
            
            ctx.strokeStyle = '#22c55e';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(sx(minY), sy(minY));
            ctx.lineTo(sx(maxY), sy(maxY));
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#f97316';
            for (let i = 0; i < y_test.length; i++) {
                ctx.beginPath();
                ctx.arc(sx(y_pred[i]), sy(y_test[i]), 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.fillStyle = '#64748b';
            ctx.font = '10px -apple-system';
            ctx.textAlign = 'center';
            ctx.fillText('Predicted', width / 2, height - 5);
            ctx.save();
            ctx.translate(12, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Actual', 0, 0);
            ctx.restore();
        }

        function updateInsight() {
            const regType = document.getElementById('regType').value;
            const lambda = Math.pow(10, parseFloat(document.getElementById('lambdaSlider').value));
            const trainMSE = mse(y_train, predict(X_train, currentCoefs));
            const testMSE = mse(y_test, predict(X_test, currentCoefs));
            const gap = testMSE - trainMSE;
            const nonzero = currentCoefs.filter(c => Math.abs(c) > 0.01).length;
            
            document.getElementById('trainMse').textContent = trainMSE.toFixed(3);
            document.getElementById('testMse').textContent = testMSE.toFixed(3);
            document.getElementById('gapValue').textContent = gap.toFixed(3);
            
            let insight = '';
            
            if (regType === 'none') {
                insight = 'No regularization ‚Äî model can overfit. Notice the gap between train and test error.';
            } else if (lambda < 0.01) {
                insight = 'Very weak regularization. Model is almost unconstrained and may overfit.';
            } else if (lambda > 100) {
                insight = 'Very strong regularization. All coefficients are shrunk toward zero ‚Äî may underfit.';
            } else if (regType === 'l1' && nonzero < nFeatures) {
                insight = `L1 has zeroed out ${nFeatures - nonzero} coefficients. This is automatic feature selection!`;
            } else if (regType === 'l2') {
                insight = 'L2 shrinks all coefficients but keeps them non-zero. Good for preventing extreme weights.';
            } else {
                insight = `At Œª=${lambda.toFixed(2)}: train MSE=${trainMSE.toFixed(2)}, test MSE=${testMSE.toFixed(2)}.`;
            }
            
            document.getElementById('insightText').textContent = insight;
        }

        function updateAll() {
            document.getElementById('nSamplesValue').textContent = document.getElementById('nSamplesSlider').value;
            document.getElementById('noiseValue').textContent = document.getElementById('noiseSlider').value;
            document.getElementById('trueFeatValue').textContent = document.getElementById('trueFeatSlider').value;
            
            const logLambda = parseFloat(document.getElementById('lambdaSlider').value);
            const lambda = Math.pow(10, logLambda);
            document.getElementById('lambdaValue').textContent = lambda.toFixed(logLambda < 0 ? -logLambda + 1 : 1);
            
            generateData();
            
            const regType = document.getElementById('regType').value;
            currentCoefs = fitModel(lambda, regType);
            
            drawErrorChart();
            drawPathChart();
            drawCoefGrid();
            drawFitChart();
            updateInsight();
        }

        function resetPlayground() {
            document.getElementById('regType').value = 'l2';
            document.getElementById('lambdaSlider').value = 0;
            document.getElementById('nSamplesSlider').value = 100;
            document.getElementById('noiseSlider').value = 0.5;
            document.getElementById('trueFeatSlider').value = 5;
            updateAll();
        }

        window.addEventListener('resize', updateAll);
        updateAll();
    </script>
</body>
</html>
